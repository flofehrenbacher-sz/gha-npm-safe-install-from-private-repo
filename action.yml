name: safe Install NPM Packages
description: Install Packages from a private NPM registry without running the risk of malicious packages stealing your NPM-token
# see https://github.com/actions/setup-node/blob/main/docs/advanced-usage.md#publish-to-npmjs-and-gpr-with-npm
inputs:
  NPM_TOKEN:
    description': NPM authentication token for accessing private modules.'
  registry-url:
    description: 'Optional registry to set up for auth. Will set the registry in a project level .npmrc and .yarnrc file, and set up auth to read in from env.NODE_AUTH_TOKEN.'
  node-version:
    description: 'Version Spec of the version to use. Examples: 12.x, 10.15.1, >=10.15.0.'
  node-version-file:
    description: 'File containing the version Spec of the version to use.  Examples: package.json, .nvmrc, .node-version, .tool-versions.'

runs:`
  using: composite
  steps:
  - name: Setup node environment with private repo
    uses: actions/setup-node@v4
    with:
      registry-url: ${{ inputs.registry-url }}
      node-version: ${{ inputs.node-version }}
      node-version-file: ${{ inputs.node-version-file }}
  - name: Install NPM Packages
    shell: bash
      # Skip post-install scripts here, as a malicious script could steal NPM_TOKEN
    run: npm ci --ignore-scripts
    env:
      NODE_AUTH_TOKEN: ${{ inputs.NPM_TOKEN }}
      NPM_TOKEN: ${{ inputs.NPM_TOKEN }}
  - name: Install Scripts
    shell: bash
      # `npm rebuild` will run all those post-install scripts for us.
    run: npm rebuild && npm run prepare --if-present